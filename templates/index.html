<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="icon" href="https://upload.wikimedia.org/wikipedia/commons/thumb/1/1c/Fruit_and_vegetables_on_a_market_stall.svg/1200px-Fruit_and_vegetables_on_a_market_stall.svg.png" type="image/png">
    <title>Preizo</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        /* General Body and Background - Modern Dark Accents */
        body {
            font-family: 'Inter', sans-serif; /* Modern sans-serif font */
            margin: 0;
            padding: 40px 20px; /* More padding */
            background-color: #111120; /* Dark background */
            color: #e0e0e0; /* Light text color for contrast */
            display: flex;
            justify-content: center;
            align-items: flex-start;
            min-height: 100vh;
            line-height: 1.6;
        }

        /* Main Wrapper for Two Columns */
        .main-wrapper {
            display: flex;
            flex-direction: column;
            width: 100%;
            max-width: 1400px; /* Increased max-width */
            background-color: #1a1a2e; /* Darker card background */
            border-radius: 12px;
            box-shadow: 0 8px 30px rgba(0, 0, 0, 0.5);
            overflow: hidden;
        }

        @media (min-width: 1024px) {
            .main-wrapper {
                flex-direction: row;
            }
        }

        /* Form and Preview Columns */
        .form-column, .preview-column {
            padding: 40px;
            flex: 1;
            box-sizing: border-box;
        }

        .form-column {
            border-right: 1px solid #333; /* Darker separator */
        }
        
        @media (max-width: 1023px) {
            .form-column {
                border-right: none;
                border-bottom: 1px solid #333;
            }
        }

        /* Form Styling */
        h1, h2 {
            text-align: center;
            color: #e0e0e0;
            margin-bottom: 20px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: #b0b0d0;
        }

        select, input[type="text"], input[type="number"] {
            width: 100%;
            padding: 12px;
            border-radius: 6px;
            border: 1px solid #333;
            background-color: #2a2a44;
            color: #e0e0e0;
            box-sizing: border-box;
            -webkit-appearance: none;
            -moz-appearance: none;
            appearance: none;
            transition: border-color 0.3s;
        }

        select:focus, input:focus {
            outline: none;
            border-color: #7a7ad0;
        }

        .radio-group {
            display: flex;
            gap: 20px;
        }

        .radio-group label {
            display: flex;
            align-items: center;
            cursor: pointer;
        }

        .radio-group input[type="radio"] {
            margin-right: 8px;
            background-color: #2a2a44;
            border-color: #7a7ad0;
            -webkit-appearance: radio;
            -moz-appearance: radio;
            appearance: radio;
            width: auto;
        }

        /* Buttons and File Download */
        .form-actions {
            display: flex;
            flex-direction: column;
            gap: 15px;
            margin-top: 30px;
        }

        button, .custom-file-upload {
            padding: 15px;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
            text-align: center;
        }

        button:hover, .custom-file-upload:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
        }

        .submit-button {
            background-color: #6a6ad0;
            color: white;
        }

        .submit-button:hover {
            background-color: #5a5ac0;
        }

        .preview-button {
            background-color: #4a4a6e;
            color: #e0e0e0;
        }

        .preview-button:hover {
            background-color: #3a3a5e;
        }

        /* Checkbox for Gebinde */
        .checkbox-group {
            margin-top: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .checkbox-group input[type="checkbox"] {
            width: auto;
            -webkit-appearance: checkbox;
            -moz-appearance: checkbox;
            appearance: checkbox;
        }

        .hidden-field {
            display: none;
        }

        /* Preview Area */
        .preview-column {
            background-color: #22223b;
            position: relative;
        }
        
        .preview-container {
            border: 2px dashed #666;
            border-radius: 8px;
            padding: 20px;
            min-height: 600px; /* Height for A4 aspect ratio */
            background-color: #f0f0f0; /* Paper color */
            color: black;
            display: flex;
            flex-direction: column;
            align-items: center;
            position: relative;
            overflow: hidden;
        }
        
        .preview-text {
            text-align: center;
            width: 100%;
            word-wrap: break-word; /* Prevents overflow */
        }
        
        /* Font sizes for different text elements */
        .preview-abteilung { font-size: 2.2em; font-weight: bold; margin-top: 10px; }
        .preview-marke { font-size: 1.5em; margin-top: 5px; }
        .preview-name { font-size: 3.5em; font-weight: bold; margin-top: 10px; }
        .preview-variante { font-size: 1em; margin-top: 5px; color: red; }
        .preview-price { font-size: 5.5em; font-weight: bold; color: black; margin-top: 10px; }
        .preview-price.red { color: red; }
        .preview-pfand, .preview-gebinde-price-unit, .preview-getraenke-price-unit, .preview-getraenke-packaging-type { font-size: 1.2em; margin-top: 5px; }
        .preview-pfand.red, .preview-gebinde-price-unit.red, .preview-getraenke-price-unit.red { color: red; }
        
        /* Utility Classes */
        .bold { font-weight: bold; }
        .underline { text-decoration: underline; }
        .red { color: red; }
        
    </style>
</head>
<body>
    <div class="main-wrapper">
        <!-- Formular-Spalte -->
        <div class="form-column">
            <h2>Preisblatt erstellen</h2>
            <form action="/" method="post" id="poster-form">
                
                <div class="form-group">
                    <label for="department">Abteilung:</label>
                    <select id="department" name="department" onchange="updatePreview()">
                        <option value="Obst und Gemüse">Obst und Gemüse</option>
                        <option value="Brot und Backwaren">Brot und Backwaren</option>
                        <option value="Käse und Wurst">Käse und Wurst</option>
                        <option value="Getränke">Getränke</option>
                        <option value="Fleisch und Geflügel">Fleisch und Geflügel</option>
                        <option value="Tiefkühlprodukte">Tiefkühlprodukte</option>
                        <option value="Süßwaren">Süßwaren</option>
                        <option value="Haushalt">Haushalt</option>
                        <option value="Molkerei">Molkerei</option>
                        <option value="Drogerie">Drogerie</option>
                    </select>
                </div>

                <div class="form-group">
                    <label>Preistyp:</label>
                    <div class="radio-group">
                        <label><input type="radio" name="product_type" value="Normalpreis" checked onchange="updatePreview()"> Normalpreis</label>
                        <label><input type="radio" name="product_type" value="Aktion" onchange="updatePreview()"> Aktion</label>
                        <label><input type="radio" name="product_type" value="Bio" onchange="updatePreview()"> Bio</label>
                    </div>
                </div>

                <div class="form-group">
                    <label for="manufacturer">Hersteller/Marke (optional):</label>
                    <input type="text" id="manufacturer" name="manufacturer" oninput="updatePreview()">
                </div>

                <div class="form-group">
                    <label for="product_name">Produktname:</label>
                    <input type="text" id="product_name" name="product_name" required oninput="updatePreview()">
                </div>

                <div class="form-group">
                    <label class="checkbox-group">
                        <input type="checkbox" id="has_variety" name="has_variety" onchange="updatePreview()">
                        Hat verschiedene Sorten?
                    </label>
                </div>
                
                <div class="form-group">
                    <label for="quantity">Menge pro Packung:</label>
                    <div style="display: flex; gap: 10px;">
                        <input type="number" id="quantity" name="quantity" placeholder="z.B. 100" oninput="updatePreview()" step="0.01">
                        <select id="unit" name="unit" onchange="updatePreview()">
                            <option value="g">g</option>
                            <option value="kg">kg</option>
                            <option value="ml">ml</option>
                            <option value="l">l</option>
                        </select>
                    </div>
                </div>

                <div class="form-group">
                    <label for="price">Preis (€):</label>
                    <input type="text" id="price" name="price" placeholder="z.B. 1,99" required oninput="updatePreview()">
                </div>
                
                <div class="form-group">
                    <label for="deposit">Pfand (€) (optional):</label>
                    <input type="text" id="deposit" name="deposit" placeholder="z.B. 0,25" oninput="updatePreview()">
                </div>

                <div class="form-group hidden-field" id="packaging-field">
                    <label for="packaging_type">Packungsart:</label>
                    <select id="packaging_type" name="packaging_type" onchange="updatePreview()">
                        <option value=""></option>
                        <option value="Dose">Dose</option>
                        <option value="Glas">Glas</option>
                        <option value="PET-Flasche">PET-Flasche</option>
                    </select>
                </div>
                
                <div class="form-group hidden-field" id="gebinde-field">
                    <label class="checkbox-group">
                        <input type="checkbox" id="gebinde-check" name="gebinde_check" onchange="toggleGebindeFields()">
                        Ist ein Gebinde?
                    </label>
                    <div id="gebinde-details" class="hidden-field" style="margin-top: 15px;">
                        <label for="gebinde_size">Anzahl pro Gebinde:</label>
                        <input type="number" id="gebinde_size" name="gebinde_size" placeholder="z.B. 6" oninput="updatePreview()">
                        <label for="inhalt_ml">Inhalt pro Flasche (ml):</label>
                        <input type="number" id="inhalt_ml" name="inhalt_ml" placeholder="z.B. 750" oninput="updatePreview()">
                    </div>
                </div>

                <div class="form-actions">
                    <button type="submit" class="submit-button" name="action" value="save">Plakat erstellen (Speichern)</button>
                    <button type="submit" class="submit-button" name="action" value="print">Plakat erstellen (Drucken)</button>
                    <button type="button" class="preview-button" onclick="updatePreview()">Vorschau aktualisieren</button>
                </div>
            </form>
            <p style="text-align: center; font-size: 0.9em; margin-top: 20px;">
                Nach dem Klick auf eine der Schaltflächen wird das Dokument als .docx-Datei ausgegeben.
            </p>
        </div>

        <!-- Vorschau-Spalte -->
        <div class="preview-column">
            <h2>Vorschau</h2>
            <div class="preview-container" id="poster-preview">
                <!-- Die Vorschau wird hier mit JavaScript generiert -->
            </div>
        </div>
    </div>

    <script>
        // Funktion zum Umschalten der Gebinde-Felder
        function toggleGebindeFields() {
            const isGebinde = document.getElementById('gebinde-check').checked;
            const gebindeDetails = document.getElementById('gebinde-details');
            if (isGebinde) {
                gebindeDetails.classList.remove('hidden-field');
            } else {
                gebindeDetails.classList.add('hidden-field');
            }
            updatePreview();
        }

        // Funktion zum Umschalten von Getränkefeldern
        function toggleDepartmentFields() {
            const department = document.getElementById('department').value;
            const packagingField = document.getElementById('packaging-field');
            const gebindeField = document.getElementById('gebinde-field');
            if (department === 'Getränke') {
                packagingField.classList.remove('hidden-field');
                gebindeField.classList.remove('hidden-field');
            } else {
                packagingField.classList.add('hidden-field');
                gebindeField.classList.add('hidden-field');
            }
            updatePreview();
        }

        function clearPreview() {
            const previewDiv = document.getElementById('poster-preview');
            previewDiv.innerHTML = '';
        }

        // Hilfsfunktion zur Vorschau-Erstellung
        function addPreviewText(parent, text, classes = []) {
            const p = document.createElement('p');
            p.textContent = text;
            p.classList.add('preview-text', ...classes);
            parent.appendChild(p);
            return p;
        }

        // Hauptfunktion zur Aktualisierung der Vorschau
        function updatePreview() {
            const previewDiv = document.getElementById('poster-preview');
            clearPreview();

            // Hole die Werte
            const department = document.getElementById('department').value;
            const productType = document.querySelector('input[name="product_type"]:checked').value;
            const manufacturer = document.getElementById('manufacturer').value;
            const productName = document.getElementById('product_name').value;
            const hasVariety = document.getElementById('has_variety').checked;
            const quantity = document.getElementById('quantity').value;
            const unit = document.getElementById('unit').value;
            const price = document.getElementById('price').value.replace(',', '.');
            const deposit = document.getElementById('deposit').value.replace(',', '.');
            const isGebinde = document.getElementById('gebinde-check').checked;
            const gebindeSize = document.getElementById('gebinde_size').value;
            const inhaltMl = document.getElementById('inhalt_ml').value;
            const packagingType = document.getElementById('packaging_type').value;

            // Farben logik
            const shouldBeRed = productType === 'Aktion';

            // Vorschau erstellen
            
            // Logos
            const logoContainer = document.createElement('div');
            logoContainer.style.display = 'flex';
            logoContainer.style.justifyContent = 'center';
            logoContainer.style.alignItems = 'center';
            logoContainer.style.marginBottom = '15px';
            
            // Kemper Markt Logo
            const kemperLogo = document.createElement('img');
            kemperLogo.src = "{{ url_for('static', filename='kemper_markt_logo.png') }}";
            kemperLogo.style.height = '40px';
            kemperLogo.style.marginRight = '10px';
            logoContainer.appendChild(kemperLogo);

            // Spezifische Logos
            if (productType === 'Aktion') {
                const aktionLogo = document.createElement('img');
                aktionLogo.src = "{{ url_for('static', filename='sonder_angebot_logo.png') }}";
                aktionLogo.style.height = '45px';
                aktionLogo.style.transform = 'scale(1.1)'; // Etwas größer
                logoContainer.appendChild(aktionLogo);
            } else if (productType === 'Bio') {
                const bioLogo = document.createElement('img');
                bioLogo.src = "{{ url_for('static', filename='bio_logo.png') }}";
                bioLogo.style.height = '50px';
                logoContainer.appendChild(bioLogo);
            }
            previewDiv.appendChild(logoContainer);


            // Horizontale Linie
            const hr = document.createElement('hr');
            hr.style.width = '80%';
            hr.style.borderTop = '2px solid black';
            hr.style.margin = '15px auto';
            previewDiv.appendChild(hr);

            // Abteilung
            addPreviewText(previewDiv, department.toUpperCase(), ['preview-abteilung', 'bold']);

            // Hersteller/Marke
            if (manufacturer) {
                addPreviewText(previewDiv, manufacturer.toUpperCase(), ['preview-marke']);
            }

            // Produktname
            addPreviewText(previewDiv, productName.toUpperCase(), ['preview-name', 'bold']);
            
            // Verschiedene Sorten
            if (hasVariety) {
                addPreviewText(previewDiv, "VERSCHIEDENE SORTEN", ['preview-variante', 'red']);
            }

            // Preis
            if (price) {
                addPreviewText(previewDiv, `${parseFloat(price).toFixed(2).replace('.', ',')}€`, ['preview-price', shouldBeRed ? 'red' : '']);
            }

            // Pfand
            if (deposit) {
                addPreviewText(previewDiv, `Zzgl.: ${parseFloat(deposit).toFixed(2).replace('.', ',')}€ Pfand`, ['preview-pfand', 'bold', shouldBeRed ? 'red' : '']);
            }

            // Gebinde oder Einzelpreis
            if (department === 'Getränke' && isGebinde) {
                if (gebindeSize && inhaltMl && price) {
                    const pricePerItem = (parseFloat(price) / parseFloat(gebindeSize)).toFixed(2).replace('.', ',');
                    const pricePerLiter = ((parseFloat(price) / (parseFloat(gebindeSize) * parseFloat(inhaltMl))) * 1000).toFixed(2).replace('.', ',');
                    addPreviewText(previewDiv, `1 St.=${pricePerItem}€ / 1L=${pricePerLiter}€`, ['preview-gebinde-price-unit', 'bold', shouldBeRed ? 'red' : '']);
                }
            } else if (quantity && unit && price) {
                let pricePerUnitText = '';
                const calcQuantity = parseFloat(quantity.replace(',', '.'));
                const calcPrice = parseFloat(price);

                if (calcQuantity > 0) {
                    if (unit.toLowerCase() === "g") pricePerUnitText = `1kg=${((calcPrice / calcQuantity) * 1000).toFixed(2).replace('.', ',')}€`;
                    else if (unit.toLowerCase() === "kg") pricePerUnitText = `1kg=${(calcPrice / calcQuantity).toFixed(2).replace('.', ',')}€`;
                    else if (unit.toLowerCase() === "ml") pricePerUnitText = `1L=${((calcPrice / calcQuantity) * 1000).toFixed(2).replace('.', ',')}€`;
                    else if (unit.toLowerCase() === "l") pricePerUnitText = `1L=${(calcPrice / calcQuantity).toFixed(2).replace('.', ',')}€`;
                }
                
                if (pricePerUnitText) {
                    addPreviewText(previewDiv, pricePerUnitText, ['preview-getraenke-price-unit', 'bold', shouldBeRed ? 'red' : '']);
                }
            }

            // Packungsart
            if (packagingType) {
                const packagingParagraph = addPreviewText(previewDiv, packagingType.toUpperCase(), ['bold', 'underline', 'preview-getraenke-packaging-type']);
                packagingParagraph.style.marginTop = '20px';
            }
        }

        // Initial calls to set correct visibility and update preview on page load
        document.addEventListener('DOMContentLoaded', () => {
            document.getElementById('department').addEventListener('change', toggleDepartmentFields);
            document.getElementById('gebinde-check').addEventListener('change', toggleGebindeFields);
            
            toggleDepartmentFields();
            updatePreview();
        });
    </script>
</body>
</html>
